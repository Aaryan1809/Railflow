<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Railway Flow Optimization Dashboard - Enhanced</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #0a1022;
            --bg-card: #1a2234;
            --bg-card-hover: #2a3348;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --accent-blue: #4f8df9;
            --accent-green: #10b981;
            --accent-red: #f43f5e;
            --accent-yellow: #fbbf24;
            --accent-purple: #a855f7;
            --accent-teal: #14b8a6;
            --shadow: 0 8px 16px -2px rgba(0, 0, 0, 0.3);
            --border-radius: 12px;
            --transition: all 0.3s ease;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-primary);
            line-height: 1.6;
        }

        h1, h2, h3 { font-family: 'Poppins', sans-serif; font-weight: 600; }

        button {
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            border: none;
            border-radius: 8px;
            padding: 10px 16px;
            background-color: var(--accent-blue);
            color: white;
            transition: var(--transition);
        }

        button:hover { opacity: 0.9; transform: translateY(-2px); }

        .container { min-height: 100vh; padding: 20px; }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background-color: var(--bg-card);
            border-radius: var(--border-radius);
            margin-bottom: 24px;
            box-shadow: var(--shadow);
        }

        .section-name { font-size: 1.4rem; font-weight: 600; }
        .datetime { color: var(--text-secondary); }

        .top-bar-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .visualization {
            background-color: var(--bg-card);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 24px;
            box-shadow: var(--shadow);
            height: 350px;
            position: relative;
            overflow: hidden;
        }

        .track-diagram {
            width: 100%;
            height: 250px;
            transition: transform 0.3s ease;
        }

        .station { fill: var(--bg-card-hover); stroke: var(--text-secondary); stroke-width: 2; }
        .station-label { fill: var(--text-primary); font-size: 12px; text-anchor: middle; font-weight: 500; }
        .track { stroke: var(--text-secondary); stroke-width: 4; stroke-linecap: round; }
        .track-secondary { stroke: var(--text-secondary); stroke-width: 2; stroke-dasharray: 5, 5; opacity: 0.7; }

        .train {
            position: absolute;
            width: 40px;
            height: 20px;
            border-radius: 6px;
            transition: left 5s linear;
            cursor: pointer;
            z-index: 10;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            color: rgba(255, 255, 255, 0.9);
        }

        .train:hover { transform: scale(1.1); z-index: 20; }
        .train-express { background: linear-gradient(135deg, #f43f5e, #e11d48); }
        .train-passenger { background: linear-gradient(135deg, #4f8df9, #3b82f6); }
        .train-freight { background: linear-gradient(135deg, #10b981, #059669); }

        .panels {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 24px;
        }

        .panel {
            background-color: var(--bg-card);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .panel-title {
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--text-secondary);
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .kpi-card {
            background: linear-gradient(145deg, var(--bg-card), var(--bg-card-hover));
            border-radius: var(--border-radius);
            padding: 16px;
            text-align: center;
        }

        .kpi-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 8px 0;
        }

        .kpi-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .kpi-trend {
            font-size: 0.8rem;
            margin-top: 4px;
        }

        .trend-up { color: var(--accent-green); }
        .trend-down { color: var(--accent-red); }

        .recommendation-card {
            background: linear-gradient(145deg, var(--bg-card), var(--bg-card-hover));
            border-radius: var(--border-radius);
            padding: 16px;
            margin-bottom: 16px;
            border-left: 4px solid var(--accent-blue);
        }

        .recommendation-card.critical { border-left-color: var(--accent-red); }
        .recommendation-card.high { border-left-color: var(--accent-yellow); }

        .recommendation-actions {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            margin-top: 12px;
        }

        .btn-accept { background-color: var(--accent-green); }
        .btn-override { background-color: var(--accent-red); }
        .btn-simulate { background-color: var(--accent-purple); }

        .log-entry {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--bg-card-hover);
            font-size: 0.9rem;
        }

        .log-time {
            color: var(--text-secondary);
            font-size: 0.8rem;
            min-width: 60px;
        }

        .optimization-score {
            background: linear-gradient(135deg, var(--accent-purple), #9333ea);
            border-radius: var(--border-radius);
            padding: 20px;
            text-align: center;
            margin-bottom: 16px;
        }

        .score-value {
            font-size: 3rem;
            font-weight: 700;
            color: white;
        }

        .score-label {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1rem;
            margin-top: 8px;
        }

        .scenario-card {
            background: var(--bg-card-hover);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
        }

        .scenario-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .metric-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            font-size: 0.85rem;
            text-align: center;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: var(--border-radius);
            padding: 30px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-modal {
            background: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            padding: 0;
        }

        @media (max-width: 768px) {
            .panels { grid-template-columns: 1fr; }
            .top-bar { flex-direction: column; gap: 12px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="top-bar">
            <div>
                <h1 class="section-name">AI Railway Flow Optimization: Nadiad – Anand Section</h1>
                <div class="datetime" id="datetime-display">Loading...</div>
            </div>
            <div class="top-bar-actions">
                <button id="ai-simulate-btn">Start AI Optimization</button>
                <button id="whatif-btn" style="background-color: var(--accent-purple);">What-If Analysis</button>
                <button id="export-btn" style="background-color: var(--accent-teal);">Export Report</button>
                <button id="reset-data-btn" style="background-color: var(--accent-red);">Reset</button>
            </div>
        </div>

        <div class="visualization">
            <h3 style="margin-bottom: 15px;">Live Track Visualization</h3>
            <svg class="track-diagram" id="track-diagram"></svg>
            <div id="trains-visualization"></div>
        </div>

        <div class="panels">
            <div class="panel">
                <h3 class="panel-title">Performance Metrics</h3>
                <div class="optimization-score">
                    <div class="score-value" id="optimization-score">0</div>
                    <div class="score-label">Optimization Score</div>
                    <div style="font-size: 0.85rem; margin-top: 8px; opacity: 0.8;">Based on throughput, delays & conflicts</div>
                </div>
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <div class="kpi-value" id="kpi-throughput">0</div>
                        <div class="kpi-label">Trains/Hour</div>
                        <div class="kpi-trend trend-up" id="throughput-trend">—</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-value" id="kpi-delay">0.0</div>
                        <div class="kpi-label">Avg. Delay (min)</div>
                        <div class="kpi-trend trend-down" id="delay-trend">—</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-value" id="kpi-utilization">0%</div>
                        <div class="kpi-label">Track Utilization</div>
                        <div class="kpi-trend trend-up" id="utilization-trend">—</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-value" id="kpi-conflicts">0</div>
                        <div class="kpi-label">Active Conflicts</div>
                        <div class="kpi-trend" id="conflicts-trend">—</div>
                    </div>
                </div>
            </div>

            <div class="panel">
                <h3 class="panel-title">AI Optimization Recommendations</h3>
                <div id="recommendations-container">
                    <p>Initializing AI optimization engine...</p>
                </div>
            </div>

            <div class="panel">
                <h3 class="panel-title">Decision Audit Log</h3>
                <div id="event-log-container" style="max-height: 400px; overflow-y: auto;"></div>
            </div>
        </div>
    </div>

    <!-- What-If Analysis Modal -->
    <div class="modal" id="whatif-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>What-If Scenario Analysis</h2>
                <button class="close-modal" id="close-whatif">×</button>
            </div>
            <div style="margin-bottom: 20px;">
                <p style="color: var(--text-secondary); margin-bottom: 16px;">
                    Simulate different operational scenarios to evaluate outcomes before implementation.
                </p>
                <button id="scenario-delay" style="width: 100%; margin-bottom: 8px;">Scenario: 30min Express Delay</button>
                <button id="scenario-breakdown" style="width: 100%; margin-bottom: 8px; background-color: var(--accent-red);">Scenario: Track Breakdown</button>
                <button id="scenario-priority" style="width: 100%; margin-bottom: 8px; background-color: var(--accent-green);">Scenario: Priority Reordering</button>
            </div>
            <div id="scenario-results"></div>
        </div>
    </div>

    <script>
        let trains = [];
        let initialTrainData = [];
        let recommendations = [];
        let eventLog = [];
        let simulationRunning = false;
        let movementInterval = null;
        let kpiHistory = { throughput: [], delay: [], utilization: [], conflicts: [] };

        const initialData = [
            {id: 1, number: '12928', type: 'express', priority: 1, direction: 'up', status: 'running', position: 250, delayMinutes: 5, speed: 15},
            {id: 2, number: '59048', type: 'passenger', priority: 2, direction: 'up', status: 'waiting', position: 100, delayMinutes: 0, speed: 10},
            {id: 3, number: '4321F', type: 'freight', priority: 3, direction: 'down', status: 'halted', position: 750, delayMinutes: 10, speed: 5},
            {id: 4, number: '19012', type: 'express', priority: 1, direction: 'down', status: 'running', position: 800, delayMinutes: 2, speed: 15},
            {id: 5, number: '22915', type: 'express', priority: 1, direction: 'up', status: 'running', position: 400, delayMinutes: 15, speed: 8},
            {id: 6, number: '69101', type: 'passenger', priority: 2, direction: 'down', status: 'running', position: 650, delayMinutes: 0, speed: 10},
            {id: 7, number: '8877F', type: 'freight', priority: 3, direction: 'up', status: 'running', position: 550, delayMinutes: 0, speed: 5},
            {id: 8, number: '12267', type: 'express', priority: 1, direction: 'down', status: 'waiting', position: 900, delayMinutes: 45, speed: 15},
        ];

        function init() {
            updateDateTime();
            setInterval(updateDateTime, 1000);
            drawTrackDiagram();
            loadInitialData();
            setupEventListeners();
            addEventLog('System initialized with AI optimization engine');
        }

        function loadInitialData() {
            initialTrainData = JSON.parse(JSON.stringify(initialData));
            trains = JSON.parse(JSON.stringify(initialData));
            renderTrains();
            updateKPIs();
        }

        function setupEventListeners() {
            document.getElementById('ai-simulate-btn').addEventListener('click', toggleSimulation);
            document.getElementById('whatif-btn').addEventListener('click', () => document.getElementById('whatif-modal').style.display = 'flex');
            document.getElementById('close-whatif').addEventListener('click', () => document.getElementById('whatif-modal').style.display = 'none');
            document.getElementById('export-btn').addEventListener('click', exportReport);
            document.getElementById('reset-data-btn').addEventListener('click', resetData);
            document.getElementById('scenario-delay').addEventListener('click', () => runScenario('delay'));
            document.getElementById('scenario-breakdown').addEventListener('click', () => runScenario('breakdown'));
            document.getElementById('scenario-priority').addEventListener('click', () => runScenario('priority'));
            document.getElementById('recommendations-container').addEventListener('click', handleRecommendationAction);
        }

        function toggleSimulation() {
            if (simulationRunning) {
                clearInterval(movementInterval);
                simulationRunning = false;
                document.getElementById('ai-simulate-btn').textContent = 'Resume Optimization';
                addEventLog('AI optimization paused by operator');
            } else {
                startSimulation();
            }
        }

        function startSimulation() {
            simulationRunning = true;
            document.getElementById('ai-simulate-btn').textContent = 'Pause Optimization';
            document.getElementById('ai-simulate-btn').style.backgroundColor = 'var(--accent-red)';
            addEventLog('AI optimization engine activated');

            movementInterval = setInterval(() => {
                let allCompleted = true;

                trains.forEach(train => {
                    if (train.status === 'running') {
                        if (train.direction === 'up') {
                            train.position += train.speed;
                            if (train.position >= 900) {
                                train.status = 'completed';
                                addEventLog(`Train ${train.number} completed journey`);
                            }
                        } else {
                            train.position -= train.speed;
                            if (train.position <= 100) {
                                train.status = 'completed';
                                addEventLog(`Train ${train.number} completed journey`);
                            }
                        }
                    }
                    if (train.status !== 'completed') allCompleted = false;
                });

                detectConflicts();
                generateRecommendations();
                renderTrains();
                updateKPIs();

                if (allCompleted) {
                    clearInterval(movementInterval);
                    simulationRunning = false;
                    document.getElementById('ai-simulate-btn').textContent = 'Optimization Complete';
                    addEventLog('All trains completed - optimization cycle finished');
                }
            }, 1000);
        }

        function detectConflicts() {
            const active = trains.filter(t => t.status === 'running');
            let conflicts = 0;

            for (let i = 0; i < active.length; i++) {
                for (let j = i + 1; j < active.length; j++) {
                    const t1 = active[i], t2 = active[j];
                    
                    if (t1.direction !== t2.direction) {
                        const distance = Math.abs(t1.position - t2.position);
                        if (distance < 200) conflicts++;
                    } else if (t1.direction === t2.direction) {
                        const distance = Math.abs(t1.position - t2.position);
                        if (distance < 100 && t1.speed > t2.speed) conflicts++;
                    }
                }
            }

            document.getElementById('kpi-conflicts').textContent = conflicts;
        }

        function generateRecommendations() {
            recommendations = [];
            const active = trains.filter(t => t.status === 'running');

            active.forEach(train => {
                if (train.priority === 1 && train.delayMinutes > 10) {
                    recommendations.push({
                        id: Date.now() + train.id,
                        trainId: train.id,
                        priority: 'high',
                        action: `Clear path for Express ${train.number}`,
                        impact: `Reduce delay by ~${Math.floor(train.delayMinutes * 0.4)}min`,
                        algorithm: 'Priority-based greedy optimization'
                    });
                }

                if (train.type === 'freight' && train.priority === 3) {
                    const blockingExpress = active.find(t => 
                        t.priority === 1 && 
                        t.direction === train.direction && 
                        Math.abs(t.position - train.position) < 150
                    );
                    if (blockingExpress) {
                        recommendations.push({
                            id: Date.now() + train.id + 1000,
                            trainId: train.id,
                            priority: 'critical',
                            action: `Divert Freight ${train.number} to loop`,
                            impact: `Prevent 15+ min delay to Express ${blockingExpress.number}`,
                            algorithm: 'Conflict minimization algorithm'
                        });
                    }
                }
            });

            renderRecommendations();
        }

        function handleRecommendationAction(e) {
            if (!e.target.dataset.recId) return;
            
            const recId = parseInt(e.target.dataset.recId);
            const action = e.target.classList.contains('btn-accept') ? 'accepted' : 'overridden';
            const rec = recommendations.find(r => r.id === recId);
            
            if (rec) {
                addEventLog(`Recommendation ${action}: ${rec.action}`);
                
                if (action === 'accepted') {
                    const train = trains.find(t => t.id === rec.trainId);
                    if (train) {
                        if (rec.action.includes('Clear path')) {
                            train.speed = Math.min(train.speed * 1.3, 20);
                            train.delayMinutes = Math.max(0, train.delayMinutes - 5);
                        } else if (rec.action.includes('Divert')) {
                            train.status = 'waiting';
                        }
                    }
                }
                
                recommendations = recommendations.filter(r => r.id !== recId);
                renderRecommendations();
            }
        }

        function runScenario(type) {
            const results = document.getElementById('scenario-results');
            results.innerHTML = '<p style="color: var(--text-secondary);">Computing scenario...</p>';
            
            setTimeout(() => {
                let html = '<div class="scenario-card">';
                
                if (type === 'delay') {
                    html += `
                        <div class="scenario-header">
                            <strong>Scenario: 30min Express Delay</strong>
                        </div>
                        <div class="metric-comparison">
                            <div><strong>Current</strong><br>12 trains/hr<br>8.5min avg delay</div>
                            <div><strong>Predicted</strong><br>10 trains/hr<br>14.2min avg delay</div>
                            <div><strong>Optimized</strong><br>11 trains/hr<br>10.8min avg delay</div>
                        </div>
                        <p style="margin-top: 12px; font-size: 0.9rem; color: var(--text-secondary);">
                            Recommendation: Reroute 2 passenger trains to parallel track. Use dynamic priority allocation for next 3 hours.
                        </p>
                    `;
                } else if (type === 'breakdown') {
                    html += `
                        <div class="scenario-header">
                            <strong>Scenario: Track Breakdown at Uttarsanda</strong>
                        </div>
                        <div class="metric-comparison">
                            <div><strong>No Action</strong><br>0 trains/hr<br>Complete halt</div>
                            <div><strong>Manual</strong><br>4 trains/hr<br>35min avg delay</div>
                            <div><strong>AI-Optimized</strong><br>7 trains/hr<br>22min avg delay</div>
                        </div>
                        <p style="margin-top: 12px; font-size: 0.9rem; color: var(--text-secondary);">
                            Recommendation: Activate single-line working. Prioritize express trains bidirectionally. Hold freight at terminals.
                        </p>
                    `;
                } else {
                    html += `
                        <div class="scenario-header">
                            <strong>Scenario: Dynamic Priority Reordering</strong>
                        </div>
                        <div class="metric-comparison">
                            <div><strong>Current</strong><br>12 trains/hr<br>3 conflicts</div>
                            <div><strong>Reordered</strong><br>15 trains/hr<br>1 conflict</div>
                            <div><strong>Improvement</strong><br>+25%<br>-67%</div>
                        </div>
                        <p style="margin-top: 12px; font-size: 0.9rem; color: var(--text-secondary);">
                            Recommendation: Apply reinforcement learning model for next 50 trains. Expected 18% throughput improvement.
                        </p>
                    `;
                }
                
                html += '</div>';
                results.innerHTML = html;
                addEventLog(`What-If analysis completed: ${type} scenario`);
            }, 1500);
        }

        function exportReport() {
            const report = {
                timestamp: new Date().toISOString(),
                section: 'Nadiad-Anand',
                metrics: {
                    throughput: document.getElementById('kpi-throughput').textContent,
                    avgDelay: document.getElementById('kpi-delay').textContent,
                    utilization: document.getElementById('kpi-utilization').textContent,
                    conflicts: document.getElementById('kpi-conflicts').textContent,
                    optimizationScore: document.getElementById('optimization-score').textContent
                },
                trains: trains.length,
                recommendations: recommendations.length,
                auditLog: eventLog
            };
            
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `railway-optimization-report-${Date.now()}.json`;
            a.click();
            
            addEventLog('Performance report exported successfully');
        }

        function resetData() {
            if (simulationRunning) toggleSimulation();
            trains = JSON.parse(JSON.stringify(initialTrainData));
            eventLog = [];
            recommendations = [];
            kpiHistory = { throughput: [], delay: [], utilization: [], conflicts: [] };
            addEventLog('System reset to initial state');
            renderTrains();
            updateKPIs();
            renderRecommendations();
        }

        function updateKPIs() {
            const active = trains.filter(t => t.status !== 'completed');
            const running = trains.filter(t => t.status === 'running').length;
            
            const throughput = Math.floor(8 + Math.random() * 6);
            const avgDelay = active.length > 0 ? 
                (active.reduce((sum, t) => sum + t.delayMinutes, 0) / active.length).toFixed(1) : 0;
            const utilization = active.length > 0 ? Math.floor((running / active.length) * 100) : 0;
            const conflicts = parseInt(document.getElementById('kpi-conflicts').textContent) || 0;
            
            document.getElementById('kpi-throughput').textContent = throughput;
            document.getElementById('kpi-delay').textContent = avgDelay;
            document.getElementById('kpi-utilization').textContent = utilization + '%';
            
            // Calculate optimization score (0-100)
            const score = Math.min(100, Math.floor(
                (throughput / 15) * 40 + 
                (1 - avgDelay / 30) * 30 + 
                (utilization / 100) * 20 + 
                (1 - conflicts / 5) * 10
            ));
            document.getElementById('optimization-score').textContent = score;
            
            updateTrends(throughput, avgDelay, utilization, conflicts);
        }

        function updateTrends(throughput, delay, utilization, conflicts) {
            kpiHistory.throughput.push(throughput);
            kpiHistory.delay.push(parseFloat(delay));
            kpiHistory.utilization.push(utilization);
            kpiHistory.conflicts.push(conflicts);
            
            if (kpiHistory.throughput.length > 10) {
                Object.keys(kpiHistory).forEach(key => kpiHistory[key].shift());
            }
            
            if (kpiHistory.throughput.length >= 2) {
                const idx = kpiHistory.throughput.length - 1;
                
                const throughputTrend = kpiHistory.throughput[idx] - kpiHistory.throughput[idx - 1];
                document.getElementById('throughput-trend').textContent = 
                    throughputTrend > 0 ? `↑ +${throughputTrend}` : throughputTrend < 0 ? `↓ ${throughputTrend}` : '—';
                document.getElementById('throughput-trend').className = 
                    throughputTrend > 0 ? 'kpi-trend trend-up' : throughputTrend < 0 ? 'kpi-trend trend-down' : 'kpi-trend';
                
                const delayTrend = kpiHistory.delay[idx] - kpiHistory.delay[idx - 1];
                document.getElementById('delay-trend').textContent = 
                    delayTrend < 0 ? `↓ ${delayTrend.toFixed(1)}` : delayTrend > 0 ? `↑ +${delayTrend.toFixed(1)}` : '—';
                document.getElementById('delay-trend').className = 
                    delayTrend < 0 ? 'kpi-trend trend-up' : delayTrend > 0 ? 'kpi-trend trend-down' : 'kpi-trend';
            }
        }

        function renderRecommendations() {
            const container = document.getElementById('recommendations-container');
            
            if (recommendations.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary);">No critical optimizations needed. System operating efficiently.</p>';
                return;
            }
            
            container.innerHTML = '';
            recommendations.forEach(rec => {
                const card = document.createElement('div');
                card.className = `recommendation-card ${rec.priority}`;
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                        <strong>${rec.action}</strong>
                        <span style="background: var(--accent-${rec.priority === 'critical' ? 'red' : 'yellow'}); 
                                     color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem;">
                            ${rec.priority.toUpperCase()}
                        </span>
                    </div>
                    <div style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 8px;">
                        <strong>Impact:</strong> ${rec.impact}
                    </div>
                    <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 12px;">
                        <em>Algorithm:</em> ${rec.algorithm}
                    </div>
                    <div class="recommendation-actions">
                        <button class="btn-simulate" data-rec-id="${rec.id}">Simulate</button>
                        <button class="btn-accept" data-rec-id="${rec.id}">Accept & Execute</button>
                        <button class="btn-override" data-rec-id="${rec.id}">Override</button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function renderTrains() {
            const container = document.getElementById('trains-visualization');
            container.innerHTML = '';
            
            trains.forEach(train => {
                if (train.status === 'completed') return;
                
                const el = document.createElement('div');
                el.className = `train train-${train.type}`;
                el.style.left = `${train.position}px`;
                el.style.top = train.direction === 'up' ? '85px' : '105px';
                el.textContent = train.number;
                el.title = `${train.type} ${train.number} - ${train.status} - Delay: ${train.delayMinutes}min`;
                container.appendChild(el);
            });
        }

        function drawTrackDiagram() {
            const svg = document.getElementById('track-diagram');
            svg.setAttribute('viewBox', '0 0 1000 200');
            
            // Main track
            const mainTrack = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            mainTrack.setAttribute('d', 'M 100 100 L 900 100');
            mainTrack.setAttribute('class', 'track');
            svg.appendChild(mainTrack);
            
            // Loop lines
            const loops = [
                {d: 'M 100 80 L 300 80', label: 'Loop 1'},
                {d: 'M 500 80 L 700 80', label: 'Loop 2'},
                {d: 'M 100 120 L 300 120', label: 'Loop 3'},
                {d: 'M 700 120 L 900 120', label: 'Loop 4'}
            ];
            
            loops.forEach(loop => {
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', loop.d);
                path.setAttribute('class', 'track-secondary');
                svg.appendChild(path);
            });
            
            // Stations
            const stations = [
                {name: 'Nadiad', x: 100},
                {name: 'Kanjari', x: 300},
                {name: 'Uttarsanda', x: 500},
                {name: 'Ode', x: 700},
                {name: 'Anand', x: 900}
            ];
            
            stations.forEach(station => {
                const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                rect.setAttribute('x', station.x - 25);
                rect.setAttribute('y', 85);
                rect.setAttribute('width', 50);
                rect.setAttribute('height', 30);
                rect.setAttribute('class', 'station');
                svg.appendChild(rect);
                
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', station.x);
                text.setAttribute('y', 150);
                text.setAttribute('class', 'station-label');
                text.textContent = station.name;
                svg.appendChild(text);
            });
        }

        function addEventLog(message) {
            const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute: '2-digit', second: '2-digit'});
            eventLog.unshift({ time, message });
            
            if (eventLog.length > 50) eventLog.pop();
            
            const container = document.getElementById('event-log-container');
            container.innerHTML = '';
            
            eventLog.forEach(entry => {
                const div = document.createElement('div');
                div.className = 'log-entry';
                div.innerHTML = `
                    <div class="log-time">${entry.time}</div>
                    <div class="log-message">${entry.message}</div>
                `;
                container.appendChild(div);
            });
        }

        function updateDateTime() {
            document.getElementById('datetime-display').textContent = new Date().toLocaleString();
        }

        window.addEventListener('load', init);
    </script>
</body>
</html>